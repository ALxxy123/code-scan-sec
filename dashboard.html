<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Scanner Dashboard - Enhanced</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            animation: gradientShift 15s ease infinite;
            background-size: 200% 200%;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
            50% { box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            animation: fadeInUp 0.6s ease-out;
        }

        header {
            background: white;
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #667eea, #764ba2, #667eea);
            background-size: 200% 100%;
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 3em;
            margin-bottom: 10px;
            display: inline-block;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-top: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.6s ease-out;
            animation-fill-mode: both;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--card-color, #667eea), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
            animation: glow 2s ease-in-out infinite;
        }

        .stat-card:nth-child(1) { --card-color: #3498db; animation-delay: 0.1s; }
        .stat-card:nth-child(2) { --card-color: #e74c3c; animation-delay: 0.2s; }
        .stat-card:nth-child(3) { --card-color: #f39c12; animation-delay: 0.3s; }
        .stat-card:nth-child(4) { --card-color: #27ae60; animation-delay: 0.4s; }

        .stat-icon {
            font-size: 3em;
            margin-bottom: 10px;
            display: block;
            animation: pulse 2s ease-in-out infinite;
        }

        .stat-value {
            font-size: 3.5em;
            font-weight: bold;
            margin: 15px 0;
            background: linear-gradient(135deg, var(--card-color, #667eea), #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #666;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
        }

        .panel {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            animation: fadeInUp 0.8s ease-out;
        }

        .panel h2 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #f0f0f0;
            font-size: 1.8em;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 30px 0;
        }

        .scan-form {
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 1em;
        }

        input[type="text"], select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: background 0.3s;
        }

        .checkbox-group:hover {
            background: #e9ecef;
        }

        input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 35px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .scan-item {
            padding: 20px;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            margin-bottom: 20px;
            transition: all 0.3s;
            background: #fafafa;
        }

        .scan-item:hover {
            border-color: #667eea;
            background: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .status {
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status.running {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .status.completed {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .status.failed {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .status.queued {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .status-indicator {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-indicator.connected {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            box-shadow: 0 0 15px rgba(39, 174, 96, 0.5);
        }

        .status-indicator.disconnected {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 2px;
        }

        .badge-success { background: #27ae60; color: white; }
        .badge-danger { background: #e74c3c; color: white; }
        .badge-warning { background: #f39c12; color: white; }
        .badge-info { background: #3498db; color: white; }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            h1 {
                font-size: 2.2em;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.8em;
            }

            .stat-value {
                font-size: 2.5em;
            }
        }

        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è Security Scanner Dashboard</h1>
            <p class="subtitle">‚ú® Real-time security monitoring and vulnerability detection ‚ú®</p>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-icon">üìä</span>
                <div class="stat-label">Total Scans</div>
                <div class="stat-value" id="totalScans">0</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">üîç</span>
                <div class="stat-label">Active Scans</div>
                <div class="stat-value" id="activeScans">0</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">üîë</span>
                <div class="stat-label">Secrets Found</div>
                <div class="stat-value" id="totalSecrets">0</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">üêõ</span>
                <div class="stat-label">Vulnerabilities</div>
                <div class="stat-value" id="criticalVulns">0</div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="panel" style="margin-bottom: 25px;">
            <h2>üìä Security Analytics</h2>
            <div class="chart-container">
                <canvas id="vulnerabilityChart"></canvas>
            </div>
        </div>

        <div class="main-content">
            <div class="panel">
                <h2>üöÄ Start New Scan</h2>

                <div class="connection-status">
                    <div class="status-indicator" id="wsIndicator"></div>
                    <span id="wsStatus">Connecting to server...</span>
                </div>

                <form class="scan-form" id="scanForm">
                    <div class="form-group">
                        <label for="scanPath">üìÅ Scan Path</label>
                        <input type="text" id="scanPath" placeholder="/path/to/scan" value="." required>
                    </div>

                    <div class="form-group">
                        <label for="aiProvider">ü§ñ AI Provider</label>
                        <select id="aiProvider">
                            <option value="gemini">üî∑ Google Gemini (Recommended)</option>
                            <option value="openai">üü¢ OpenAI GPT-4</option>
                            <option value="claude">üü£ Anthropic Claude</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableAI" checked>
                            <label for="enableAI" style="margin: 0;">‚ú® Enable AI Verification</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableVulns" checked>
                            <label for="enableVulns" style="margin: 0;">üêõ Enable Vulnerability Scan</label>
                        </div>
                    </div>

                    <button type="submit" id="scanButton">
                        üîç Start Security Scan
                    </button>
                </form>

                <div id="scanResults"></div>
            </div>

            <div class="panel">
                <h2>üìú Recent Scans</h2>
                <div id="recentScans">
                    <p style="text-align: center; color: #999; padding: 30px;">
                        No scans yet. Start a new scan to see results here.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = 'http://localhost:8000';
        const WS_URL = 'ws://localhost:8000/ws';

        // WebSocket connection
        let ws = null;
        let reconnectAttempts = 0;
        const MAX_RECONNECT_ATTEMPTS = 5;

        // Charts
        let vulnerabilityChart = null;

        // Initialize charts
        function initCharts() {
            const ctx = document.getElementById('vulnerabilityChart');
            if (ctx) {
                vulnerabilityChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Critical', 'High', 'Medium', 'Low', 'Clean'],
                        datasets: [{
                            data: [0, 0, 0, 0, 100],
                            backgroundColor: [
                                '#e74c3c',
                                '#f39c12',
                                '#f1c40f',
                                '#3498db',
                                '#27ae60'
                            ],
                            borderWidth: 3,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: {
                                        size: 14
                                    }
                                }
                            },
                            title: {
                                display: true,
                                text: 'Vulnerability Distribution',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            }
                        },
                        animation: {
                            animateRotate: true,
                            animateScale: true
                        }
                    }
                });
            }
        }

        // Connect to WebSocket
        function connectWebSocket() {
            try {
                ws = new WebSocket(WS_URL);

                ws.onopen = () => {
                    console.log('WebSocket connected');
                    reconnectAttempts = 0;
                    updateConnectionStatus(true);
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    handleWebSocketMessage(data);
                };

                ws.onclose = () => {
                    console.log('WebSocket disconnected');
                    updateConnectionStatus(false);

                    if (reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {
                        reconnectAttempts++;
                        setTimeout(connectWebSocket, 3000 * reconnectAttempts);
                    }
                };

                ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                };
            } catch (error) {
                console.error('Failed to connect WebSocket:', error);
                updateConnectionStatus(false);
            }
        }

        // Update connection status UI
        function updateConnectionStatus(connected) {
            const indicator = document.getElementById('wsIndicator');
            const status = document.getElementById('wsStatus');

            if (connected) {
                indicator.classList.add('connected');
                indicator.classList.remove('disconnected');
                status.textContent = '‚úÖ Connected to server';
            } else {
                indicator.classList.add('disconnected');
                indicator.classList.remove('connected');
                status.textContent = '‚ùå Disconnected from server';
            }
        }

        // Handle WebSocket messages
        function handleWebSocketMessage(data) {
            console.log('WebSocket message:', data);

            switch (data.type) {
                case 'scan_progress':
                    updateScanProgress(data.scan_id, data.progress, data.message);
                    break;
                case 'scan_complete':
                    updateScanComplete(data.scan_id, data.results);
                    break;
                case 'scan_error':
                    updateScanError(data.scan_id, data.error);
                    break;
                case 'heartbeat':
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.send('pong');
                    }
                    break;
            }
        }

        // Fetch dashboard statistics
        async function fetchStats() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/dashboard/stats`);
                const data = await response.json();

                document.getElementById('totalScans').textContent = data.total_scans || 0;
                document.getElementById('activeScans').textContent = data.active_scans || 0;
                document.getElementById('totalSecrets').textContent = data.total_secrets_found || 0;
                document.getElementById('criticalVulns').textContent = data.critical_vulnerabilities || 0;

                // Update chart
                if (vulnerabilityChart && data.vulnerability_distribution) {
                    const dist = data.vulnerability_distribution;
                    vulnerabilityChart.data.datasets[0].data = [
                        dist.critical || 0,
                        dist.high || 0,
                        dist.medium || 0,
                        dist.low || 0,
                        dist.clean || 100
                    ];
                    vulnerabilityChart.update();
                }

                if (data.recent_scans) {
                    updateRecentScans(data.recent_scans);
                }
            } catch (error) {
                console.error('Failed to fetch stats:', error);
            }
        }

        // Update recent scans list
        function updateRecentScans(scans) {
            const container = document.getElementById('recentScans');

            if (!scans || scans.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 30px;">No scans yet.</p>';
                return;
            }

            container.innerHTML = scans.map(scan => `
                <div class="scan-item">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <strong style="color: #667eea;">#${scan.scan_id ? scan.scan_id.substring(0, 8) : 'N/A'}</strong>
                        <span class="status ${scan.status || 'queued'}">${scan.status || 'queued'}</span>
                    </div>
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">
                        üìÅ ${scan.path || 'N/A'}
                    </div>
                    ${scan.results ? `
                        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px;">
                            <span class="badge badge-danger">üîë ${scan.results.secrets?.length || 0} Secrets</span>
                            <span class="badge badge-warning">üêõ ${scan.results.vulnerabilities?.length || 0} Vulns</span>
                            <span class="badge badge-danger">üî¥ ${scan.results.vulnerabilities?.filter(v => v.severity === 'critical').length || 0} Critical</span>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Handle scan form submission
        document.getElementById('scanForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const button = document.getElementById('scanButton');
            button.disabled = true;
            button.innerHTML = '<span class="loading-spinner"></span> Starting scan...';

            const payload = {
                path: document.getElementById('scanPath').value,
                enable_ai: document.getElementById('enableAI').checked,
                ai_provider: document.getElementById('aiProvider').value,
                enable_vulnerabilities: document.getElementById('enableVulns').checked,
                output_format: 'json'
            };

            try {
                const response = await fetch(`${API_BASE}/api/v1/scan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (response.ok) {
                    showNotification(`‚úÖ Scan started successfully! ID: ${data.scan_id}`, 'success');
                    setTimeout(fetchStats, 1000);
                } else {
                    showNotification(`‚ùå Error: ${data.detail}`, 'error');
                }
            } catch (error) {
                showNotification(`‚ùå Failed to start scan: ${error.message}`, 'error');
            } finally {
                button.disabled = false;
                button.innerHTML = 'üîç Start Security Scan';
            }
        });

        // Show notification
        function showNotification(message, type) {
            alert(message);
        }

        // Update scan progress
        function updateScanProgress(scanId, progress, message) {
            console.log(`Scan ${scanId}: ${progress}% - ${message}`);
            setTimeout(fetchStats, 500);
        }

        // Update scan complete
        function updateScanComplete(scanId, results) {
            console.log(`Scan ${scanId} completed:`, results);
            showNotification('‚úÖ Scan completed successfully!', 'success');
            fetchStats();
        }

        // Update scan error
        function updateScanError(scanId, error) {
            console.error(`Scan ${scanId} failed:`, error);
            showNotification(`‚ùå Scan failed: ${error}`, 'error');
            fetchStats();
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            connectWebSocket();
            fetchStats();
            setInterval(fetchStats, 5000); // Refresh every 5 seconds
        });
    </script>
</body>
</html>
